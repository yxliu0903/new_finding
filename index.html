<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Discovery</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: white;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 1.5em;
            margin: 10px 0;
            font-weight: bold;
        }

        .discovery-canvas {
            flex: 1;
            position: relative;
            background: white;
            overflow: hidden;
        }

        .base-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #999;
            opacity: 0.2;
            z-index: 1;
        }

        .architecture-layer {
            position: absolute;
            width: 40%;
            height: 75%;
            opacity: 0;
            transition: all 0.5s ease-in-out;
            z-index: 2;
            border-radius: 0;
            overflow: hidden;
            transform: scale(0.8);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: white;
            padding: 0;
            margin: 0;
            border: none;
            box-sizing: border-box;
            line-height: 0;
            font-size: 0;
        }

        .architecture-layer.milestone-highlight {
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            border: 3px solid #ffd700;
            transform: scale(1.1) rotate(0deg);
            z-index: 10;
        }

        .architecture-layer.active {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .architecture-layer.new-finding {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            border: 2px solid #ffd700;
        }

        .new-finding-label {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.8em;
            z-index: 10;
        }







        .milestone {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2em;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.5s ease;
            z-index: 100;
            text-align: center;
        }

        .milestone.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        /* SVG样式优化 */
        .architecture-layer svg {
            width: 100% !important;
            height: 100% !important;
            object-fit: fill;
            display: block !important;
            line-height: 0 !important;
            font-size: 0 !important;
        }
        
        .architecture-layer svg * {
            margin: 0 !important;
            padding: 0 !important;
        }


    </style>
</head>
<body>
    <div class="container">
        <div class="title">🚀 AI Architecture Discovery</div>
        


        <div class="discovery-canvas" id="discoveryCanvas">
            <div class="base-image">
                <div>🧠 AI Foundation</div>
            </div>
        </div>






        <div class="milestone" id="milestone">
            🎉 Move 37 Moment!
        </div>
    </div>

    <script>
        class ArchitectureDiscovery {
            constructor() {
                this.architectures = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.newFindingsCount = 0;
                this.milestoneShown = false;
                this.autoPlayInterval = null;
                
                this.init();
            }

            async init() {
                try {
                    console.log('开始加载架构数据...');
                    const response = await fetch('data/106.json');
                    console.log('数据响应状态:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    this.architectures = await response.json();
                    console.log('成功加载架构数据，共', this.architectures.length, '个条目');
                    
                    this.updateInfo();
                    this.setupEventListeners();
                    
                    // 自动开始播放
                    setTimeout(() => {
                        console.log('开始自动播放...');
                        this.startDiscovery();
                    }, 1000);
                } catch (error) {
                    console.error('Error loading architectures:', error);
                    this.showError('无法加载架构数据: ' + error.message);
                }
            }

            setupEventListeners() {
                // 移除所有事件监听器，因为控制按钮已被删除
            }

            startDiscovery() {
                if (this.currentIndex >= this.architectures.length) {
                    this.resetDiscovery();
                }
                this.isPlaying = true;
                
                // 清除之前的定时器
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                }
                
                // 设置500ms间隔的自动播放
                this.autoPlayInterval = setInterval(() => {
                    if (this.isPlaying) {
                this.showNextArchitecture();
                    }
                }, 500);
            }

            pauseDiscovery() {
                this.isPlaying = false;
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
            }

            resetDiscovery() {
                this.currentIndex = 0;
                this.newFindingsCount = 0;
                this.milestoneShown = false;
                this.isPlaying = false;
                this.clearCanvas();
                this.updateInfo();
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
            }

            clearCanvas() {
                const canvas = document.getElementById('discoveryCanvas');
                const layers = canvas.querySelectorAll('.architecture-layer');
                layers.forEach(layer => layer.remove());
            }

            showNextArchitecture() {
                console.log('显示第', this.currentIndex + 1, '个架构');
                
                if (this.currentIndex >= this.architectures.length) {
                    console.log('所有架构已显示完毕');
                    this.completeDiscovery();
                    return;
                }

                const arch = this.architectures[this.currentIndex];
                console.log('当前架构:', arch.name || arch.name_new);
                
                const layer = this.createArchitectureLayer(arch);
                
                // 随机位置
                this.setRandomPosition(layer);
                
                document.getElementById('discoveryCanvas').appendChild(layer);
                
                // 触发动画
                setTimeout(() => {
                    layer.classList.add('active');
                }, 50);

                // 检查是否是新发现（分数高于平均值的1.5倍）
                const avgScore = this.getAverageScore();
                if (arch.score > avgScore * 1.5) {
                    this.markAsNewFinding(layer, arch);
                }

                // 检查里程碑
                if (this.currentIndex === 37 && !this.milestoneShown) {
                    this.showMilestone();
                    // 高亮当前架构图
                    layer.classList.add('milestone-highlight');
                }

                this.currentIndex++;
                this.updateInfo();
                
                // 不再清理旧的架构图，让它们永远保留
                // 注意：这里注释掉了清理逻辑，架构图会一直保留在画布上
            }

            createArchitectureLayer(arch) {
                const layer = document.createElement('div');
                layer.className = 'architecture-layer';
                
                // 创建SVG容器并设置样式
                const svgContainer = document.createElement('div');
                svgContainer.innerHTML = arch.svg_picture;
                svgContainer.style.width = '100%';
                svgContainer.style.height = '100%';
                svgContainer.style.display = 'block';
                svgContainer.style.background = 'white';
                svgContainer.style.padding = '0';
                svgContainer.style.margin = '0';
                svgContainer.style.boxSizing = 'border-box';
                svgContainer.style.lineHeight = '0';
                svgContainer.style.fontSize = '0';
                
                // 优化SVG大小并去掉白边
                const svg = svgContainer.querySelector('svg');
                if (svg) {
                    svg.style.width = '100%';
                    svg.style.height = '100%';
                    svg.style.maxWidth = '100%';
                    svg.style.maxHeight = '100%';
                    svg.style.background = 'white';
                    svg.style.padding = '0';
                    svg.style.margin = '0';
                    svg.style.border = 'none';
                    svg.style.boxSizing = 'border-box';
                    svg.style.display = 'block';
                    svg.style.lineHeight = '0';
                    svg.style.fontSize = '0';
                    svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
                    
                    // 强制移除SVG内部的所有空白
                    svg.setAttribute('xml:space', 'preserve');
                    const allElements = svg.querySelectorAll('*');
                    allElements.forEach(el => {
                        if (el.style) {
                            el.style.margin = '0';
                            el.style.padding = '0';
                        }
                    });
                    
                    // 调整viewBox来裁剪左右白色边距
                    const viewBox = svg.getAttribute('viewBox');
                    if (viewBox) {
                        const parts = viewBox.split(' ');
                        if (parts.length === 4) {
                            const x = parseFloat(parts[0]);
                            const y = parseFloat(parts[1]);
                            const width = parseFloat(parts[2]) - x;
                            const height = parseFloat(parts[3]) - y;
                            
                            // 只裁剪左右边距，保留上下边距
                            const cropPercent = 0.15; // 裁剪15%的左右边距
                            const cropX = width * cropPercent;
                            const newWidth = width - 2 * cropX;
                            
                            svg.setAttribute('viewBox', `${x + cropX} ${y} ${newWidth} ${height}`);
                        }
                    }
                }
                
                layer.appendChild(svgContainer);
                return layer;
            }

            setRandomPosition(layer) {
                const canvas = document.getElementById('discoveryCanvas');
                const canvasRect = canvas.getBoundingClientRect();
                
                // 计算可用区域（减去架构图本身的尺寸）
                const layerWidth = canvasRect.width * 0.4; // 40%宽度
                const layerHeight = canvasRect.height * 0.75; // 75%高度
                
                // 确保架构图不会超出屏幕边界
                const maxX = Math.max(0, canvasRect.width - layerWidth);
                const maxY = Math.max(0, canvasRect.height - layerHeight);
                
                // 使用更均匀的分布，确保架构图在屏幕中央
                const gridCols = 3;
                const gridRows = 2;
                const cellWidth = maxX / gridCols;
                const cellHeight = maxY / gridRows;
                
                // 随机选择一个网格单元，但避免最左边的列
                const gridX = Math.floor(Math.random() * (gridCols - 1)) + 1; // 从1开始，避免最左边
                const gridY = Math.floor(Math.random() * gridRows);
                
                // 在网格单元内随机位置，确保不超出边界
                const margin = 15;
                const minX = Math.max(0, gridX * cellWidth + margin);
                const maxCellX = Math.min(maxX - layerWidth, (gridX + 1) * cellWidth - layerWidth - margin);
                const x = minX + Math.random() * Math.max(0, maxCellX - minX);
                
                const minY = Math.max(0, gridY * cellHeight + margin);
                const maxCellY = Math.min(maxY - layerHeight, (gridY + 1) * cellHeight - layerHeight - margin);
                const y = minY + Math.random() * Math.max(0, maxCellY - minY);
                
                // 设置位置
                layer.style.left = x + 'px';
                layer.style.top = y + 'px';
                
                // 添加随机旋转和缩放变化
                const rotation = (Math.random() - 0.5) * 20; // -10度到+10度
                const scale = 0.8 + Math.random() * 0.2; // 0.8到1.0之间
                layer.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
            }



            markAsNewFinding(layer, arch) {
                layer.classList.add('new-finding');
                
                const label = document.createElement('div');
                label.className = 'new-finding-label';
                label.textContent = 'NEW FINDINGS!';
                layer.appendChild(label);
                
                this.newFindingsCount++;
            }

            showMilestone() {
                this.milestoneShown = true;
                const milestone = document.getElementById('milestone');
                milestone.classList.add('show');
                
                setTimeout(() => {
                    milestone.classList.remove('show');
                }, 3000);
            }

            getAverageScore() {
                const scores = this.architectures.map(arch => arch.score).filter(score => score !== null && score !== undefined);
                return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
            }

            updateInfo() {
                // 移除信息更新，因为相关元素已被删除
            }

            completeDiscovery() {
                this.isPlaying = false;
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
                
                // 不显示完成信息，静默完成
            }

            showError(message) {
                alert('错误: ' + message);
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            new ArchitectureDiscovery();
        });
    </script>
</body>
</html> 