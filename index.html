<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Discovery</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: white;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 1.5em;
            margin: 10px 0;
            font-weight: bold;
        }

        .discovery-canvas {
            flex: 1;
            position: relative;
            background: white;
            overflow: hidden;
        }

        .base-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: #999;
            opacity: 0.2;
            z-index: 1;
        }

        .architecture-layer {
            position: absolute;
            width: 20%;
            height: 25%;
            opacity: 0;
            transition: all 0.5s ease-in-out;
            z-index: 2;
            border-radius: 8px;
            overflow: hidden;
            transform: scale(0.8);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .architecture-layer.active {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }

        .architecture-layer.new-finding {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            border: 2px solid #ffd700;
        }

        .new-finding-label {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.8em;
            z-index: 10;
        }

        .progress-bar {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8em;
            color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .milestone {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2em;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: all 0.5s ease;
            z-index: 100;
            text-align: center;
        }

        .milestone.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        /* SVGæ ·å¼ä¼˜åŒ– */
        .architecture-layer svg {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸš€ AI Architecture Discovery</div>
        
        <div class="controls">
            <button class="btn" id="startBtn">å¼€å§‹</button>
            <button class="btn" id="pauseBtn" disabled>æš‚åœ</button>
            <button class="btn" id="resetBtn">é‡ç½®</button>
        </div>

        <div class="discovery-canvas" id="discoveryCanvas">
            <div class="base-image">
                <div>ğŸ§  AI Foundation</div>
            </div>
        </div>

        <div class="info" id="info">
            <div>è¿›åº¦: <span id="progress">0/0</span></div>
            <div>æ–°å‘ç°: <span id="newFindings">0</span></div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="milestone" id="milestone">
            ğŸ‰ 37 Move Moment!<br>
            <span style="font-size: 0.8em;">æ¶æ„å‘ç°çš„å…³é”®æ—¶åˆ»</span>
        </div>
    </div>

    <script>
        class ArchitectureDiscovery {
            constructor() {
                this.architectures = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.newFindingsCount = 0;
                this.milestoneShown = false;
                this.autoPlayInterval = null;
                
                this.init();
            }

            async init() {
                try {
                    console.log('å¼€å§‹åŠ è½½æ¶æ„æ•°æ®...');
                    const response = await fetch('data/106.json');
                    console.log('æ•°æ®å“åº”çŠ¶æ€:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    this.architectures = await response.json();
                    console.log('æˆåŠŸåŠ è½½æ¶æ„æ•°æ®ï¼Œå…±', this.architectures.length, 'ä¸ªæ¡ç›®');
                    
                    this.updateInfo();
                    this.setupEventListeners();
                    
                    // è‡ªåŠ¨å¼€å§‹æ’­æ”¾
                    setTimeout(() => {
                        console.log('å¼€å§‹è‡ªåŠ¨æ’­æ”¾...');
                        this.startDiscovery();
                    }, 1000);
                } catch (error) {
                    console.error('Error loading architectures:', error);
                    this.showError('æ— æ³•åŠ è½½æ¶æ„æ•°æ®: ' + error.message);
                }
            }

            setupEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startDiscovery());
                document.getElementById('pauseBtn').addEventListener('click', () => this.pauseDiscovery());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetDiscovery());
            }

            startDiscovery() {
                if (this.currentIndex >= this.architectures.length) {
                    this.resetDiscovery();
                }
                this.isPlaying = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('pauseBtn').disabled = false;
                
                // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                }
                
                // è®¾ç½®100msé—´éš”çš„è‡ªåŠ¨æ’­æ”¾
                this.autoPlayInterval = setInterval(() => {
                    if (this.isPlaying) {
                this.showNextArchitecture();
                    }
                }, 100);
            }

            pauseDiscovery() {
                this.isPlaying = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
            }

            resetDiscovery() {
                this.currentIndex = 0;
                this.newFindingsCount = 0;
                this.milestoneShown = false;
                this.isPlaying = false;
                this.clearCanvas();
                this.updateInfo();
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('milestone').classList.remove('show');
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
            }

            clearCanvas() {
                const canvas = document.getElementById('discoveryCanvas');
                const layers = canvas.querySelectorAll('.architecture-layer');
                layers.forEach(layer => layer.remove());
            }

            showNextArchitecture() {
                console.log('æ˜¾ç¤ºç¬¬', this.currentIndex + 1, 'ä¸ªæ¶æ„');
                
                if (this.currentIndex >= this.architectures.length) {
                    console.log('æ‰€æœ‰æ¶æ„å·²æ˜¾ç¤ºå®Œæ¯•');
                    this.completeDiscovery();
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç†æ—§çš„æ¶æ„å›¾
                this.cleanupOldLayers();

                const arch = this.architectures[this.currentIndex];
                console.log('å½“å‰æ¶æ„:', arch.name || arch.name_new);
                
                const layer = this.createArchitectureLayer(arch);
                
                // éšæœºä½ç½®
                this.setRandomPosition(layer);
                
                document.getElementById('discoveryCanvas').appendChild(layer);
                
                // è§¦å‘åŠ¨ç”»
                setTimeout(() => {
                    layer.classList.add('active');
                }, 50);

                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°å‘ç°ï¼ˆåˆ†æ•°é«˜äºå¹³å‡å€¼çš„1.5å€ï¼‰
                const avgScore = this.getAverageScore();
                if (arch.score > avgScore * 1.5) {
                    this.markAsNewFinding(layer, arch);
                }

                // æ£€æŸ¥é‡Œç¨‹ç¢‘
                if (this.currentIndex === 37 && !this.milestoneShown) {
                    this.showMilestone();
                }

                this.currentIndex++;
                this.updateInfo();
            }

            createArchitectureLayer(arch) {
                const layer = document.createElement('div');
                layer.className = 'architecture-layer';
                
                // åˆ›å»ºSVGå®¹å™¨å¹¶è®¾ç½®æ ·å¼
                const svgContainer = document.createElement('div');
                svgContainer.innerHTML = arch.svg_picture;
                svgContainer.style.width = '100%';
                svgContainer.style.height = '100%';
                svgContainer.style.display = 'flex';
                svgContainer.style.alignItems = 'center';
                svgContainer.style.justifyContent = 'center';
                
                // ä¼˜åŒ–SVGå¤§å°
                const svg = svgContainer.querySelector('svg');
                if (svg) {
                    svg.style.width = '100%';
                    svg.style.height = '100%';
                    svg.style.maxWidth = '100%';
                    svg.style.maxHeight = '100%';
                    svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
                }
                
                layer.appendChild(svgContainer);
                return layer;
            }

            setRandomPosition(layer) {
                const canvas = document.getElementById('discoveryCanvas');
                const canvasRect = canvas.getBoundingClientRect();
                
                // è®¡ç®—å¯ç”¨åŒºåŸŸï¼ˆå‡å»æ¶æ„å›¾æœ¬èº«çš„å°ºå¯¸ï¼‰
                const layerWidth = canvasRect.width * 0.20; // 20%å®½åº¦
                const layerHeight = canvasRect.height * 0.25; // 25%é«˜åº¦
                
                const maxX = canvasRect.width - layerWidth;
                const maxY = canvasRect.height - layerHeight;
                
                // ä½¿ç”¨æ›´å¯†é›†çš„ç½‘æ ¼ç³»ç»Ÿæ¥æ›´å¥½åœ°åˆ†å¸ƒ
                const gridCols = 5;
                const gridRows = 4;
                const cellWidth = maxX / gridCols;
                const cellHeight = maxY / gridRows;
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªç½‘æ ¼å•å…ƒ
                const gridX = Math.floor(Math.random() * gridCols);
                const gridY = Math.floor(Math.random() * gridRows);
                
                // åœ¨ç½‘æ ¼å•å…ƒå†…éšæœºä½ç½®ï¼Œç•™å‡ºè¾¹è·
                const margin = 20;
                const x = gridX * cellWidth + margin + Math.random() * (cellWidth - layerWidth - margin * 2);
                const y = gridY * cellHeight + margin + Math.random() * (cellHeight - layerHeight - margin * 2);
                
                // è®¾ç½®ä½ç½®
                layer.style.left = x + 'px';
                layer.style.top = y + 'px';
                
                // æ·»åŠ éšæœºæ—‹è½¬å’Œç¼©æ”¾å˜åŒ–
                const rotation = (Math.random() - 0.5) * 30; // -15åº¦åˆ°+15åº¦
                const scale = 0.7 + Math.random() * 0.3; // 0.7åˆ°1.0ä¹‹é—´
                layer.style.transform = `scale(${scale}) rotate(${rotation}deg)`;
            }

            cleanupOldLayers() {
                const layers = document.querySelectorAll('.architecture-layer');
                const maxLayers = 20; // æœ€å¤šä¿ç•™20ä¸ªæ¶æ„å›¾
                
                if (layers.length > maxLayers) {
                    // ç§»é™¤æœ€æ—§çš„å‡ ä¸ªæ¶æ„å›¾
                    const layersToRemove = layers.length - maxLayers;
                    for (let i = 0; i < layersToRemove; i++) {
                        if (layers[i]) {
                            layers[i].style.opacity = '0';
                            layers[i].style.transform = 'scale(0.5) rotate(45deg)';
                            setTimeout(() => {
                                if (layers[i] && layers[i].parentNode) {
                                    layers[i].parentNode.removeChild(layers[i]);
                                }
                            }, 300);
                        }
                    }
                }
            }

            markAsNewFinding(layer, arch) {
                layer.classList.add('new-finding');
                
                const label = document.createElement('div');
                label.className = 'new-finding-label';
                label.textContent = 'NEW FINDINGS!';
                layer.appendChild(label);
                
                this.newFindingsCount++;
            }

            showMilestone() {
                this.milestoneShown = true;
                const milestone = document.getElementById('milestone');
                milestone.classList.add('show');
                
                setTimeout(() => {
                    milestone.classList.remove('show');
                }, 3000);
            }

            getAverageScore() {
                const scores = this.architectures.map(arch => arch.score).filter(score => score !== null && score !== undefined);
                return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
            }

            updateInfo() {
                document.getElementById('progress').textContent = `${this.currentIndex}/${this.architectures.length}`;
                document.getElementById('newFindings').textContent = this.newFindingsCount;
                
                const progress = (this.currentIndex / this.architectures.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }

            completeDiscovery() {
                this.isPlaying = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                
                if (this.autoPlayInterval) {
                    clearInterval(this.autoPlayInterval);
                    this.autoPlayInterval = null;
                }
                
                // æ˜¾ç¤ºå®Œæˆä¿¡æ¯
                const milestone = document.getElementById('milestone');
                milestone.innerHTML = 'ğŸ‰ å‘ç°å®Œæˆ!<br><span style="font-size: 0.8em;">å…±å‘ç° ' + this.newFindingsCount + ' ä¸ªé‡è¦çªç ´</span>';
                milestone.classList.add('show');
                
                setTimeout(() => {
                    milestone.classList.remove('show');
                }, 5000);
            }

            showError(message) {
                alert('é”™è¯¯: ' + message);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new ArchitectureDiscovery();
        });
    </script>
</body>
</html> 